가장 대표적인 배포 전략은 네가지이다. (실제 AWS 서비스 중 배포 기능을 가진것은 아래 중 하나가 들어가있다.)

- 인플레이스 배포(In-place Deployment)
- 롤링 배포(Rolling Update Deployment)
- 블루/ 그린 배포(Blue/ Green Deployment)
- 카나리 배포(Canary Deployment)

## 인플레이스 배포(In-place Deployment)

![in-place Deployment](https://blog.kakaocdn.net/dn/yyaLj/btqSpGaTvEN/xyw6pg1fJC3OSHAG16bh20/img.png)

1. 로드밸런서와 서버 B의 역할을 해제한다.
2. 연결이 해제된 서버 B를 업데이트 한다.
3. 업데이트가 끝나면 로드밸런서에 서버 B를 연결시키고 그 후에 서버 A를 로드밸런서에서 연결 해제한다.
4. A를 업데이트하고 다시 로드밸런서에 연결한다.

현재 사용 가능한 자원을 그대로 이용하며 운영중인 상태에서 무중단으로 배포할 수 있다.
무중단 배포 방식 중 굉장히 간단한 방식에 속하고 장단점도 명확하다.

- [c] 롤백시 같은 방식으로 진행한다.
      업데이트에 문제 발생시 효율적이지 못하다
  - [c] 가용중이던 서버 자원이 적어진다

## 롤링 배포(Rolling)

트래픽을 점진적으로 구버전에서 새버전으로 옮기는 방식
점진적으로 트래픽을 어떻게 새로운 버전으로 옮기는 지에 대한 방식은 조금씩 다르다.
![롤링배포1](https://hudi.blog/static/rolling-deployment-2-f9d7e1eae7c7a5be1629fd5dda3c011b.gif)
- 인스턴스를 하나 추가하고, 새로운 버전을 실행한다. 로드밸런서에 이 인스턴스를 연결하고, 기존 구버전 어플리케이션이 실행되는 인스턴스를 하나 줄인다.
![롤링배포2](https://hudi.blog/static/rolling-deployment-bf6f561cf6dd6e9fe9cbc45530dcadb2.gif)
- V1이 실행되고 있는 서버 하나를 로드밸런서에서 떼어낸다.
  이렇게 되면 해당 서버에는 트래픽이 도달하지 않게된다. 이 상태에서 해당 서버의 어플리케이션을 V2로 교체한다.
- 이버전에 경우 클라우드 환경이 아닌, 물리적 서버로 서비스를 운영하는 상황에서도 사용할 수 있다.

- [p] k8s, elastic beanstalk와 같은 많은 오케스트레이션 도구에서 지원하여 간편하다.
- [p] 많은 서버 자원을 확보하지 않아도 무중단 배포가 가능하다.
- [p] 점진적으로 새로운 버전이 사용자에게 출시되므로, 배포로 인한 위험성이 다소 줄어들 수 있다.
- [c] 방식2의 경우 서비스중인 인스턴스가 줄어들게 되어 각각의 서버가 부담하는 트래픽의 양이 늘어날 수 있다.
- [c] 구버전과 신버전 어플리케이션이 동시에 서비스 되기때문에 호환성 문제가 발생할 수 있다. 

## 블루 그린 배포(Blue/Green Deployment)

![Blue/Green 배포](https://hudi.blog/static/blue-green-deployment-4787416bca99a5dd28577d99caa44340.gif)

- Blue: 현재 운영중인 서비스의 환경
- Green: 새롭게 배포할 환경

Blue와 Green의 서버를 나란히 구성해둔 상태로 배포 시점에 로드밸런서가 트래픽을 Blue에서 Green으로 일제히 전환시킨다.
Green 버전 배포가 성공적으로 완료되었고, 문제가 없다고 판단했을 때에 Blue버전을 제거할 수 있다.
- 혹은 다음 배포를 위해 유지해둘 수 있다.

- [p] 롤링 배포와 달리 트래픽을 모두 새로운 버전은로 옮기기 때문에 호환성 문제가 발생하지 않는다.
- [c] 실제 운영에 필요한 서버 리소스 대비 2배의 리소스를 확보해야 한다.
	클라우드 환경에서 운영한다면 필요 없는 인스턴스를 제거하면 그만이지만, 온프레미스환경은 비용 부담이 크다.  


## 카나리(Canary) 배포

![카나리 배포](https://hudi.blog/static/canary-deployment-3f4cfe177dc1d0b6c632c85521ad0b6d.gif)

- 카나리 배포의 핵심은 새로운 버전에 대한 오류를 조기에 감지하는 것이다.
- 소수의 인원에 대해서만 트래픽을 새로운 버전에 옮겨둔 상태에서 서비스를 운영한다.
  새로운 버전에 이상이 없다고 한단하였을 경우에는 모든 트래픽을 신규버전으로 옮긴다.
  > 이때 트래픽을 새로운 버전으로 옮기는 기준은 정해진 규칙 혹은 랜덤이다.

이러한 특징으로 인해 A/B테스트를 진행하기에도 적합한 방식이다.

- [p] 새로운 버전으로 인한 위험을 최소화 할 수 있다.
- [c] 롤링 배포와 마찬가지로 신/구 버전의 애플리케이션이 동시에 존재하므로, 호환성 문제가 발생할 수 있다.  

---
[매번 헷갈리는 CI/CD 배포 전략 정리해버리기](https://dev.classmethod.jp/articles/ci-cd-deployment-strategies-kr/)
- [무중단 배포 아키텍처와 배포 전략 (Rolling, Blue/Green, Canary)](https://hudi.blog/zero-downtime-deployment/)