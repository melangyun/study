# 2.2.1 블록체인 관련 용어
## 1) 해시(Hash)

해시함수란 임의 길이의 데이터를 Hash함수에 입력하면 `고정된 길이의 랜덤(Random) 값을 출력`하는것을 말한다. 
- 어떤 데이터를 입력하더라도 출력값은 고정된 길이의 랜덤 값을 출력한다.
- 입력 값에 대해 어떤 값이 출력될지는 예측할 수 없으며, 출력 값을 가지고 입력값을 유추할 수 없다.
- 입력값에 점 하나만 바뀌어도 완전히 다른 값을 출력한다.

### 예시 - 머클트리

트랜젝션 데이터에 단계적으로 해시함수를 적용하여 하나의 해시값으로 나타내는 구조이다.
![머클트리](https://image.binance.vision/editor-uploads/9e31057c05a84b49a35b477c4c2b9734.png)

만약 세번째 트랜잭션에서 데이터를 변경한다면 관련된 모든 해시값이 연달아 변경되게 된다.
모든 데이터에 대한 수정 여부를 점검할 필요 없이, <u>최상단 하나의 값만 점검해도 모든 데이터의 수정 여부를 체크할 수 있다.</u>
![[머클트리(2-12).png]]

## 2) 암호와 비대칭키 암호

평문을 암호문으로 암호화할때는 키(key)가 필요하다.

- **대칭키**: 암/복호화 키가 동일
- **비대칭키**: 암/복호화 키가 다른경우 (공개키/개인키)

### 비대칭키 특징

- 대칭키의 키 배송 문제 해결
- 공개키와 개인키가 수학적 연관성을 기반으로 쌍으로 구성
- 공개키는 외부에 공개 가능, 개인키는 외부에 공개되면 안됨
- 공개키로 암호화하면 개인키로 복호화, 개인키로 암호화하면 공개키로 복호화

## 3) 노드(NODE)

블록체인 네트워크에 참여한 모든 컴퓨터/사용자를 의미

> 참여 형태가 프로그램(`Bitcoin org`) 을 설치한 컴퓨터를  통해 이루어지기 때문에, 네트워크에 참여하는 컴퓨터(PC, 서버, 스마트폰 등 다양한 컴퓨팅 디바이스 포함)을 노드라고 한다.

## 4) 트랜잭션

수행하는 논리적인 작업 단위. 하나의 작업으로 처리가 가능할 수도 있고, 일련의 작업이 모여야 정상 작업이 완료되는 경우도 있다.

## 5) 블록(Block)

`Block`은 DB에서도 사용되는 용어이다.
- 레코드: 더 이상 분리되지 않는 최소 데이터 저장 단위
- 블록: 여러 개의 **레코드들로 구성된 묶음**
- 파일: 여러 개의 블록들의 묶음

블록체인에서 '블록'의 개념도 데이터베이스의 블록과유사하다.

>[!info] 블록: 트랜잭션(서비스 실행 최소 데이터)를 일정 크기로 묶어놓은 단위

### 블록은 크게 3개 영역으로 구성

1. Body
	거래내역인 트랜잭션들이 **모두** 저장되어 있는 영역
2. Header
	**트랜잭션**들에 대한 **정보 요약** 및 **블록 관련 정보** 포함
3. Block Hash
	블록을 하나의 값으로 표현한 **대푯값**으로, 수많은 블록으로 구성된 블록체인에서 해당 블록을 식별하는 기준이 된다.
	
![[블록구조(2-17).png]]
3개 영역이 모두 독립적으로 존재하는 것이 아니라, **Body의 모든 정보가 요약되어 Header에 포함되고, Header정보가 하나의 값으로 표현된것이 Block Hash** 이다.

개별 트랜잭션은 각각 해시값을 구하고 해시값들을 연결하여 하나의 해시값(머클루트)으로 포현할 수 있다.
이 값은 Header에 저장된다. 그리고 <u>6개 항목으로 구성된 Header의 모든 데이터를 해시함수를 거쳐 하나의 해시값으로 표현한 값이 Block Hash</u>다.
![[블록 구조 상세(2-18).png]]

블록 하나의 크기는 초기에는 1MB정도로 설계되었다.
하지만 현재 시점에서 이론적 최대 크기는 `4MB`이며, 실제 거래 구성에 따라 `1MB ~ 2MB` 사이의 크기를 가진다.

>트랜잭션을 일정 시간단위로 모아서 Body에 저장하고, 해당 트랜잭션들에 대한 요약 정보를 Header로 포함한 형태가 Block이다. 이런 블록들을 체인(Chain) 형태로 모두 연결한 것이 블록체인(Blockchain)이다.

## 6) 블록체인

거래내역이 계속 발생함에 따라 새로운 블록이 계속 생성되며, 새로운 블록은 기존 블록체인에 모두 연결된다. (마치 링크드 리스트처럼) 이런 구조가 마치 체인처럼 연결되어 있다고 해서 '블록체인'이라고 부른다.


## 7) 기밀성 - 무결성 - 가용성

- 기밀성(Confidentiality)
	- 인가된 사람에게만 정보를 공개하는것
	- 허가받지 않는 사람에게 중요한 정보가 노출되지 않게 하는 것 (!= 익명성)
- 무결성(Integrity)
	- 변경 및 위-변조로부터 데이터를 보호
	- 중앙관리자/시스템이 부재한 블록체인에서는 어떠한 상황에서도 장부 데이터가 수정되거나 삭제되지 않도록 설계하여 무결성을 보장해야 한다.
- 가용성(Availablilty)
	- 어떤 상황과 환경에서도 서비스가 정상적이고 지속적으로 운영될 수 있는 능력
	- 가용성 보장을 위한 대표 방법이 `분산배치`이다.
	- 블록체인에서 분산 배치는 투명성/신뢰성을 보장하기 위한 목적이 크지만, 가용성도 보장한다.

# 2.2.2 블록체인 기본 구성도

블록상의 트랜잭션들은 파편화 되어있지 않고 실제로는 논리적으로 연결되어 있다.
![[블록체인 내부 구조(2-22).png]]

## 노드 구성도

노드: 비트코인 네트워크에 참여하는 각각의 컴퓨터

### **구성**
노드는 크게 지갑, Memory Pool, 블록체인으로 구성되어 있다.
- **지갑**: 개인키와 공개키가 보관된 영역
- **Memory Pool**: 전파된 트랜잭션이 신규 불록 생성 이전까지 잠시 대기하는 저장소 영역
- **블록체인**: 블록체인이라는 장부가 저장되는 영역


### 역할
1. **트랜잭션 생성**
	지갑의 개인키와 공개키를 이용하여 새로운 트랜잭션 생성
2. **검증**
	<u>트랜잭션이 네트워크 전체에 전파되었을 경우</u> 검증
3. **블록 생성 및 채굴**
	후보 블록을 생성하고 채굴 과정을 거쳐 최종 블록 생성
4. **블록체인에 저장**
	합의를 마친 블록을 블록체인에 연결하여 저장

트랜잭션 검증이 완료되면 `Memory Pool`에서 잠시 대기한다. 트랜잭션들이 모여서 블록 생성이 되며, 바로 블록체인에 연결되지는 않는다.
각 노드는 MemPool에 저장된 트랜잭션들을 이용하여 먼저 후보블록을 생성하고, 이 후보블록 중에서 <u>합의를 위한 네트워크에 참여한 모든 노드끼리 경쟁 과정을 거쳐 하나의 최종블록이 선정되고,  최종 블록 하나만 블록체인에 최종적으로 연결된다.</u>
대표 블록에 포함된 트랜잭션들은 MemPool에서 삭제한다.

## 네트워크 구성도

각 노드는 인터넷을 통해 모두 연결되어 있으며, 전체 네트워크를 통제하는 중앙 시스템은 존재하지 않는다.
참여한 모든 노드가 동등한 권한으로 서로 통신한다. 또, 각 노드들은 동일한 블록체인 장부를 저장하고 있다.
![[네트워크 구성도(2-24).png]]
참여 노드 현황은 https://bitnodes.io 에서 볼 수 있다.
`Bitconin Core`라는 프로그램이 설치돼 있어야 노드로 참여할 수 있다.

# 2.2.3 블록체인 작동 주요 절차

블록체인은 트랜잭션이 전파되면 바로 동기화되는 것이 아니라 각 노드가 전파된 트랜잭션을 모아서 후보블록을 각각 생성하고 각 노드에 있는 후보 블록들이 경쟁하여 하나의 대표블록을 선정한다. 그리고 이렇게 선정된 대표블록을 다시 전파하는 형식으로 동기화한다.

1. 지갑을 통해 거래(트랜잭션) 생성
2. 생성된 트랜잭션은 네트워크를 통해 모든 노드에 전파
3. 각 노드는 수신된 트랜잭션을 검증
4. 검증된 트랜잭션은 잠시 Memory Pool에 저장
5. 각 노드는 일정 시간 동안 쌓인 트랜잭션을 모아서 **노드별 후보 블록**을 생성
6. 후보블록 중 대표블록 생성(채굴)
7. 선정된 대표 블록은 다시 네트워크를 통해 모든 노드에 전파
8. 각 노드는 수신된 대표블록을 검증
9. 검증된 대표블록은 각 노드에 저장된 블록체인에 연결
