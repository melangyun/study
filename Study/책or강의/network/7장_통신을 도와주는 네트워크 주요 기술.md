종단 장비에서 패킷이 시작되어 중간 네트워크 장비에서 패킷을 처리하는 과정 외에도 IP 네트워크에는 통신을 도와주고 사용자를 편리하게 하는 다양한 서비스와 프로토콜이 존재.

- IP주소를 자동으로 할당해주는 DHCP(Dynamic Host Configuration Protocol)
- 사용자가 복잡한 목적지 IP를 기억하지 않고 쉬운 도메인 이름을 사용하도록 IP주소를 매핑해주는 DNS(Domain Name System)
- 사용자가 가장 가까운 지역의 데이터 센터에 접속해 신속한 서비스를 받게 해주는 GSLB(Global Service Load Balancing)
- 하나의 IP를 사용, 여러 단말 장비를 포함하는 네트워크 구축을 도와주는 NAT
등등


# 7.1 NAT/PAT 
**NAT(Network Address Translation; 네트워크 주소 변환)**
ip패킷이 트래픽 라우팅 장비를 거치면서 이동 때, 헤더에 있는 IP정보를 수정 하는 정보를 말함. 이러한 기능은 보통 라우터/ 방화벽에 설치됨

하나의 네트워크 주소에 다른 하나의 네트워크 주소로 변환하는 1:1 변환이 기본이지만, IP 주소가 고갈되는 문제를 해결하기 위해 1:1 변환이 아닌 여러 개의 IP를 하나의 IP로 변환하기도 함. 
	- **PAT(Port Address Translation)** 는 Dynamic NAT의 한 종류라고 볼 수 있는 NAPT(Network Address Port Tarslation => 실무에서는 PAT), <u>공인 IP주소 1개에 사설 IP주소 여러개를 매핑하는것.</u> 변환된 IP주소로는 사내망 호스트들을 구분할 수 없기 때문에 포트 번호를 부여하여 구분.

## 7.1.1 NAT/PAT의 용도와 필요성
(7.1.2 NAT동작방식 217p)
(7.1.3 PAT동작방식 219p)
1. IPv4주소 고갈문제의 솔루션
	단기, 중기, 장기의 IP주소 보존과 전환 전략을 수립하였다.
	- 단기: 서브네팅
	- 중기: **NAT**와 사설 IP체계
		외부에 공개해야 하는 서비스에 대해 공인 IP를 사용, 공개할 필요가 없는 일반 사용자의 PC나 기타 종단장비에 대해서는 사설 IP를 사용해 *꼭 필요한 곳에만 효율적으로 IP를 사용할 수 있게 되었다.*
	- 장기: IPv6전환
2. 보안 강화
	외부와 통신할 때 내부 IP를 다른 IP로 변환해 통신하면 외부에 사내 IP주소 체계를 숨길 수 있다.
3. IP주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 해준다.
4. 불필요한 설정 변경을 줄일 수 있다.

그러나, 네트워크 운영자 입장에서는 IP가 변환되면 장애가 발생했을 때 문제 해결이 힘들다. 애플리케이션 개발자는 NAT환경이 대중화되면서 애플리케이션을 개발할 때 더 많은 고려사항이 생김

## 7.1.4 SNAT와 DNAT
**SNAT(Source NAT)**; 출발지 주소 변경 NAT 
	- 사설에서 공인으로 통신할 때
	- 보안상 SNAT를 사용 할 때
	- 로드밸런서의 구성에 따라

**DNAT(Desticiation NAT)**; 도착지 주소변경 NAT
	- 로드밸런서에서 많이 사용
	- 사내가 아닌 대외망과의 네트워크 구성

## 7.1.5 동적 NAT와 정적 NAT
![[동적_정적NAT.jpg]]
- 정적 NAT: 출발지와 목적지 IP를 미리 매핑해 고정해놓은 NAT
	- 사전에 정의되어있으므로 1:1 NAT이라고 부르기도함.
- 동적 NAT: 사전에 정해지지 않고 NAT을 수행할 때 IP를 동적으로 변경하는것
	- 출발지나 목적지 중 한 곳이 다수의 IP로 구성된 풀이나 레인지로 설정되어 있다.
		NAT가 필요할 때 IP풀에서 어떤 IP로 매핑될것인지 판단, NAT 테이블(일정 시간만 유지)을 만들어 관리

# 7.2 DNS(Domain Name System)
네트워크 프로토콜
- 데이터 프로토콜: 실제로 데이터를 나름
- 컨트롤 프로토콜: 데이터 프로토콜이 잘 동작하도록 도움
	통신에 직접 관여하지는 않지만, 처음 통신 관계를 맺거나 유지하는데 큰 역할을 함

> TCP/IP 프로토콜을 유지하기위한 컨트롤 프로토콜에는 ARP, ICMP, DNS가 있다.

## 7.2.1 DNS 소개
숫자로 구성된 IP주소보다 의미있는 문자열로 구성된 도메인 주소가 우리가 인식하고 기억하기 더 쉽다.
IP 주소 대신 도메인 주소를 이용하면 하나의 IP주소를 이용해 여러 개의 웹 서비스를 운영할 수 있고, 서비스중인 IP주소가 변경되더라도 도메인 주소를 그대로 유지해 접속 방법 변경 없이 서비스를 그대로 유지 할 수 있다.
따라서 특별한 경우를 제외하면 대부분 웹사이트는 도메인 주소 기반으로 운영한다.

## 7.2.2 DNS 구조와 명명 규칙
도메인은 계층구조여서 수많은 인터넷 주소 중 원하는 주소를 효율적으로 찾아갈 수 있다.
역트리 구조로 최상위 루트부터 TOP-Level 도메인, Second-Level도메인, Thrid-Level도메인과 같이 하위 레벨로 원하는 주소를 단계적으로 찾아간다.
(각 계증의 경계를`.` 로 표시하고, 뒤에서 부터 앞으로 해석)
![[도메인계층.jpg]]
> *최대 128계층*까지 구성할 수 있으며, *계층별 길이는 최대 63바이트*까지 사용 할 수 있고, 계층을 구분하는 구분자 "."를 포함한 전체 도메인 네임의 길이는 *255바이트*까지 사용 가능
> 문자는 알파벳, 숫자 "-" 만 사용할 수 있고, *대소문자 구분이 없다.*

### 7.2.2.1 루트 도메인
도메인을 구성하는 최상위 영역.

### 7.2.2.2 Top-Level Domain(TLD)
최상위 도메인인 TLD는 IANA(Internet Assigned Numbers Authority)에서 구분한 6가지 유형으로 구분할 수 있다.
- Generic(gTLD)
	특별한 제한 없이 일반적으로 사용되는 최상위 도메인. 세글자 이상으로 구성됨
	초기 gTLD는 7개의 gTLD *(.com, .edu, .gov, .int, .mil, .net, .org)* 로 시작했으며 필요에 의해 새로운 gTLD가 지속적으로 만들어 지고 있다.
- country-code(ccTLD)
	두 글자의 국가 코드 사용. 우리나라는 *kr*을 사용.
	일반적으로 ccTLD를 사용하는 경우, Second Level TLD에는 gTLD에서 구분한 것 처럼 사이트 용도에 따른 코드 사용.
	> 일반 회사는 `co.kr`, 정부 기관은 `go.kr`을 사용.
- sponsered(sTLD)
	특정 목적을 위한 스폰서를 두고 있는 최상위 도메인.
	스폰서는 특정 민족 공동체, 전문가 집단, 지리적 위치 등이 속할 수 있다. *(.aero, .asia, .edu, .museum) 등*
- infrastructure
	운용상 중요 인프라 식별자 공간을 지원하기 위해 전용으로 사용되는 최상위 도메인.
- generic-restricted(grTLD)
	특정기준을 충족하는 사람, 단체가 사용할 수 있는 최상위 도메인 *(.biz, .name, .pro) 등*
- test(tTLD)
	IDN(Interneationalized Domain Names) 개발 프로세스에서 테스트 목적으로 사용하는 최상위 도메인. *(.test)*

## 7.2.3 DNS 동작 방식
도메인을 IP주소로 변환하려면 DNS서버에 도메인 쿼리하는 과정이 필요하다.
하지만 DNS서버 없이, 로컬에서 도메인과 IP주소를 직접 설정(hosts 파일 설정)해 사용 할 수 있다.

**클라이언트 관점에서 DNS질의 과정**
- 도메인을 쿼리하면 DNS서버 쿼리 이전 로컬의 DNS 캐시 정보 먼저 확인
	- 동적 DNS캐시와 함께, hosts파일에 저장되어있는 정적 DNS캐시가 함께 저장되어 있다.
- DNS 캐시 정보에 필요한 도메인 정보가 없으면 DNS서버로 쿼리.
- DNS서버로 응답을 받으면 캐시에 저장

**DNS 시스템 관점에서 결괏값을 클라이언트에 보내주는 과정**
DNS는 분산된 데이터베이스로 서로 도와주도록 설계되어 있는데, 자신이 가진 도메인 정보가 아니면 다른 DNS에 질의해 결과를 받을 수 있다.

- DNS는 도메인의 TLD값을 확인, 해당 TLD값을 관리하는 DNS가 어디인지 응답.
	- zigispzce.net 이라는 도메인을 클라이언트가 DNS서버에 쿼리
	- 루트 DNS -> `.net`을 관리하는 DNS서버 주소를 질의, 응답
	- 응답받은 `.net`을 관리하는 DNS서버에 zigispace.net DNS정보 쿼리, 응답
	- 클라이언트 응답
	=> 처음 질의를 받은 DNS가 중심이 되어 책임지고 루트 DNS부터 상위 DNS에 차근 차근 쿼리를 보내 결괏값을 알아낸 후 최종 결괏값만 클라이언트에 응답.
![[도메인재귀쿼리_반복쿼리.jpg]]
> **재귀적 쿼리(Recursive Query)와 반복적 쿼리 (Iterative Query)**
> 재귀적 쿼리는 클라이언트-로컬DNS간에 사용, 반복적 쿼리는 로컬DNS와 서버와 상위 DNS구간에 사용

## 7.2.4 마스터와 슬레이브
DNS서버는 마스터와 슬레이브 서버로 나눌 수 있다.
마스터와 슬레이브는, 도메인 존(Zone) 파일을 직접 관리하는지 여부로 구분한다. 마서터 서버는 도메인 영역을 생성하고, 레코드를 직접 관리하지만  슬레이브 서버는 마스터 서버에 설정된 도메인이 가진 레코드 값을 정기적으로 복제.
마스터 서버가 우선순위가 더 높지는 않고, 두 서버 모두 도메인 쿼리에 응답한다.

> **참고: 액티브-스텐바이와 액티브- 액티브**
> 네트워크 서비스가 시스템 내부의 컴포넌트 일부가 정상적으로 동작하지 않더라도 서비스가 지속적될 수 있도록 고가용성(High Availablity)기술을 사용.
> 고가용성을 위해 일반적으로 사용하는 구조는 액티브-액티브와 액티브 스탠바이이다.
> *액티브-액티브*는 두 개의 노드가 동시에 서비스를 제공, 한 노드에 문제 발생시 다른 노드에서 서비스를 제공하는 방식
> *액티브-스탠바이*는 두개의 노드 중 액티브 노드만 서비스를 제공, 스탠바이 노드는 대기하고 있다가 노드에 장애가 발생하면 서비스를 시작하는 방식

## 7.2.5 DNS주요 레코드
|레코드 종류|내용|
|----|---|
|A(IPv4 호스트)| 도메인 주소를 IP주소(IPv4)로 매핑|
|AAAA(IPv6 호스트)| 도메인 주소를 IP주소(IPv6)로 매핑|
|CNAME(별칭)|도메인 주소에 대한 별칭|
|SOA권한 시작|본 영역 데이터에 대한 권한|
|NS(도메인의 네임 서버)|본 영역에 대한 네임 서버|
|MX(메인 교환기)|도메인에 대한 메일 서버 정보(Mail eXchanger)|
|PTR(포인터)|IP 주소를 도메인에 매핑(역방향)|
|TXT(레코드)|도메인에 대한 일반 텍스트|

- A(IPv4) 레코드 (도메인 주소 -> IP주소로 변환)
	사용자가 DNS에 질의한 도메인 주소를 IP주소로 응답. 하나의 A레코드에는 한 개의 도메인 주소와 한개의 IP주소가 1:1로 매핑.
-  AAAA(IPv6)레코드
	A레코드가 IPv4주소 체계에 사용되는 레코드라면 AAAA레코드는 IPv6주소 체계에서 사용되는 레코드. 역할은 동일함
- CNAME(Canonical Name)레코드 `"www"`
	별칭 이름을 사용하게 해주는 레코드. CNAME레코드는 도메인 주소를 매핑한다.
	네임 서버가 CANME레코드에 대한 질의를 받으면 CNAME레코드에 설정된 도메인 정보 확인, 그 도메인 정보를 내부적으로 다시 질의한 IP값 응답.
- SOA(Start Of Authority)레코드
	도메인 영역에 대한 <u>권한</u>을 나타내는 레코드. 현재 네임 서버가 이 도메인 영역에 대한 관리 주체임을 의미, 다른 서버에 질의하지 않고 직접 응답한다.
- NS(Name Server)레코드
	도메인에 대한 권한이 있는 <u>네임 서버 정보</u>를 설정하는 레코드.
	- 권한이 있는 네임 서버 정보를 해당 도메인에 설정
	- 하위 도메인에 대한 권한을 다른 네임서버로 위임(Delegate)
- PTR(Pointer)레코드 *(역방향 조회용 레코드)*
	IP주소에 대한 질의를 도메인 주소로 응답하기 위한 레코드.
	A레코드와 달리 하나의 IP주소에 대해 하나의 도메인 주소만 가질 수 있다.
- TXT(TxXT)레코드
	도메인에 대한 설명과 같이 간단한 텍스트를 입력할 수있는 레코드.
	TXT레코드에는 공백도 포함 할 수 있고 대소문자를 구분. 최대 255자
	*ex) 화이트 도메인을 위한 SPF*

## 7.2.6 DNS에서 알아두면 좋은 내용

#### 7.2.6.1 도메인 위임(DNS Delegation)
도메인은 그 도메인에 대한 정보를 관리할 수 있는 네임 서버를 지정하지만, 도메인 내의 모든 레코드를 그 네임서버가 직접 관리하지 않고, 일부 영역에 대해서는 다른 곳에서 관리하도록 위임
*-> CDN, GSLB등 다양한 용도로 사용 가능.*

#### 7.2.6.2 TTL(Time to Live)
도메인의 TTL은 DNS에 질의해 응답받은 결괏값을 <u>캐시</u>에서 유지하는 시간

**기타 도메인 관련 시간**
- refresh(새로 고침 간격): Zone Transfer를 통해 정보를 주지적으로 받아오는 주기
- retry(다시 시도 간격): 보조 네임서버-> 주네임서버 접근이 불가능할 때 재시도 하는 주기
- expire(다음 날짜 이후 만료)

#### 7.2.6.3 화이트 도메인
한국인터넷 진흥원(KISA)에서는 불법적 방법으로 발송되는 스팸 메일 차단을 하고있다. 이를 위해 정상적 도메인 인증, 관리하는 제도가 '화이트 도메인'.
반대로 불법적인 스팸 메일을 발송하는 사이트를 실시간 블랙리스트 정보로 관리, 메일 발송을 제한함(RBL; Realtime Blackhole;Blocking List).

#### 7.2.6.4 한글 도메인
도메인 주소는 영문 뿐만아니라 한글 주소도 가능하다. DNS에서는 해당 한글을 "퓨니코드"로 변경하고 퓨니코드로 DNS에 도메인을 생성

> **퓨니코드[Punycode]**
> 국제화 도메인 네임(IDNA)기반 하에서 다국어 도메인이 아스키로 변환(Encoding)된 구문.
> 한글 뿐만아니라 영어가 아닌 자국어 도메인을 사용할 수 있도록 해주는 표준 코드

## 7.3 GSLB(Global Server Load Balancing)
DNS 서비스의 발전된 형태.
DNS는 설정된 서비스 상태의 정상 여부를 확인하지 않고 도메인에 대한 질의에 대해 설정된 값을 무조건 응답한다. DNS서버에서는 각 레코드에 대한 서비스 체크가 이루어지지 않고 설정된 값에 따라 동작하므로, 서비스 가용성 향상 방법으로 부적합.
GSLB는 DNS의 이런 문제점을 해결해 도메인을 이용한 로드 밸런싱 구현을 도와줌. 도메인에 연결된 서비스가 정상적인지 헬스 체크 수행.; `인텔리전스 DNS`

### 7.3.1 GSLB 동작 방식
