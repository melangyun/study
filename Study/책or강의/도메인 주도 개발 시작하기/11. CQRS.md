# 11.2 CQRS

시스템이 제공하는 기능은 크게 두 가지로 나눌 수 있다.

- 상태를 변경하는 기능
	- 한 애그리 거트의 상태 변경
- 사용자 입장에서 상태를 조회하는 기능
	- 두 개 이상의 애그리거트가 필요할 때가 많음

상태를 변경하는 범위와 상태를 조회하는 범위가 정확하게 일치하지 않기 때문에, 단일 모델로 두 종류의 기능을 구현하면 모델이 불필요하게 복잡해진다.
이러한 복잡도 해결을 위해 CQRS(Command Query Responsibility Segregation)를 사용한다.

CQRS는 복잡한 도메인에 적합하다. 도메인이 복잡할수록 명령과 조회 기능이 다루는 데이터 범위에 차이가 난다.

CQRS를 사용하면 각 모델에 맞는 구현 기술을 선택할 수 있다.
> 예를 들어 명령 모델은 객체 지향에 기반해서 도메인 모델을 구현하기에 적당한 JPA를 사용해서 구현하고, 조회 모델은 DB테이블에서 SQL로 데이터를 조회 할 때 좋은 마이바티스를 구현하여 사용하면 된다.

명령과 조회 모델이 서로 다른 데이터 저장소를 사용할 수도 있다.
명령 모델은 트렌잭션을 지원하는 RDBMS를 사용하고, 조회 모델은 성능이 좋은 메모리 기반 NoSQL을 사용 할 수도 있다.
> 하지만, 이 경우 동기화 시점에 따라 구현 방식이 달라 질 수 있다.
> 글로벌 트랜젝션이 필요할 수도 있다.
> 하지만 동기 이벤트와 글로벌 트랜잭션을 사용하면 전반적인 성능(응답 속도와 처리량) 이 떨어진다.


> [!tip] 장점
> - 명령 모델을 구현할 때 도메인 자체에 집중할 수 있다.
> - [d] 복잡도
> - 조회 성능을 상향시키는데 유리하다.

> [!warning] 단점
> - 구현해야 할 코드가 더 많다.
> - 더 많은 구현 기술이 필요하다.(조회성능 개선을 위해서..)

