# 단일 책임 원칙

> [!info] 컴포넌트를 변경하는 이유는 오직 하나 뿐이어야 한다.

==책임==은 `오로지 한 가지 일만 하는 것`보단 `변경할 이유`로 해석해야 한다.
> 만약 컴포넌트를 변경할 이유가 한 가지 라면 우리가 어떤 다른 이유로 소프트웨어를 변경하더라도 이 컴포넌트에 대해서는 전혀 신경 쓸 필요가 없다.
> 소프트웨어가 변경되더라도 여전히 우리가 기대한 대로 동작할 것이기 때문이다.

그러나 *변경할 이유*는 컴포넌트 간의 의존성을 통해 너무나도 쉽게 전파된다.
많은 코드는 단일 책임 원칙을 위반하기 때문에 갈수록 변경하기가 더 어려워지고 그로 인해 변경 비용도 증가한다. 시간이 갈수록 컴포넌트를 변경할 더 많은 이유가 쌓여간다.
> 변경할 이유가 많이 쌓인 후 한 컴포넌트를 바꾸는 것이 다른 컴포넌트가 실패하는 원인으로 작용할 수 있다.

# 의존성 역전 원칙 (Dependency Inversion Principle; DIP)

계층형 아키텍처에서 계층 간 의존성은 항상 다음 계층인 아래 방향을 가리킨다.
> 속성 계층에 대한 도메인 계층의 의존성 때문에 영속성 계층을 변경할 때마다 잠재적으로 도메인 계층도 변경해야 한다. 그러나 도메인 코드는 애플리케이션에서 가장 중요한 코드다. 영속성 코드가 바뀐다고 해서 도메인 코드까지 바꾸고 싶지는 않다.

> [!question] 의존성을 어떻게 제거할 수 있을까?
> - [*] 의존성 역전의 원칙
>       코드 상의 어떤 의존성이든 그 방향을 바꿀 수(역전시킬 수) 있다.

# 클린 아키텍처

> [!info] 클린아키텍처
> 설계가 비즈니스 규칙의 테스트를 용이하게 하고, 비즈니스 규칙은 프레임워크, 데이터베이스,UI 기술, 그 밖의 외부 애플리케이션이나 인터페이스로부터 독립적일 수 있다
> - [p] 이는 도메인 코드가 바깥으로 향하는 어떤 의존성도 없어야 한다는것을 의미한다.
>       대신 의존성 역전 원칙의 도움으로 모든 의존성이 도메인 코드를향하고 있다.

![클린아키텍처](https://insightbookblog.files.wordpress.com/2019/10/clean_architecture_color.jpg?w=1024)
> 클린 아키텍처에서 모든 의존성은 도메인 로직을 향해 안쪽 방향으로 향한다.

아키텍처의 코어에는 주변 유스케이스에서 접근하는 도메인 엔티티들이 있다. 유스케이스는 앞에서 서비스라고 불렀던 것들인데, <u>단일책임을 갖기 위해 조금 더 세분화 돼있다</u>.
이를 통해 이전에 이야기하는 <u>넓은 서비스 문제를 기피</u>할 수 있다.

>[!info] 도메인 코드에서는 어떤 영속성 프레임워크나 UI 프레임 워크가 사용되는지 알 수 없기 때문에, 특정 프레임워크에 특화된 코드를 가질 수 없고 비즈니스 규칙에 집중할 수 있다.
>그래서 도메인 코드를 자유롭게 모델링할 수 있다.
>> ex) 도메인 주도 설계를 가장 순수한 형태로 적용해 볼 수 있다.

>[!warning] 클린 아키텍처에는 대가가 따른다.
>도메인 계층이 영속성 계층이나 UI같은 외부 계층과 철저하게 분리돼야 하므로 애플리케이션의 엔티티에 대한 모델을 각 계층에서 유지보수 해야한다.

# 육각형 아키텍처(핵사고날 아키텍처)

![핵사고날 아키텍처](https://blog.kakaocdn.net/dn/6RiLB/btqHA4l72Sk/apa5HHSutF1XIcsBU0KbkK/img.png)

> 육각형 아키텍처는 애플리케이션 코어가 각 어댑터와 상호작용하기위해 특정 포트를 제공하기 때문에 '포트와 어뎁터(ports-and-adapters)'아키텍처라고도 불린다.

애플리케이션 코어가 육각형으로 표현되어 이 아키텍처의 이름이 됐다.
> (그런데 사실 이 육각형 모양은 아무런 의미가 없다. 애플리케이션이 다른 시스템이나 어댑터와 연결되는 4개 이상의 면을 가질 수 있음을 보여주기 위해 일반적인 사각형 대신 육각형을 사용했다고 한다.)

육각형 안에는 도메인 엔티티와 상호작용하는 유스케이스가 있다. 
또, <u>육각형에서 외부로 향하는 의존성이 없기 때문에, </u>클린 아키텍처에서 제시한 의존성 규칙이 그대로 적용된다. 대신 모든 의존성은 코어를 향한다.

애플리케이션 코어와 어댑터 간의 통신이 가능하려면 애플리케이션 코어가 각각의 포트를 제공해야 한다. 
- 주도하는 어댑터: 포트가 코어에 있는 유스케이스 클래스들에 의해 구현되고 호출되는 인터페이스
- 주도되는 어댑터: 포트가 어댑터에 의해 구현되고 코어에 의해 호출되는 인터페이스
이러한 핵심 개념으로 인해 이 아키텍처 스타일은 포트와 어댑터 아키텍처로 알려져있다.

클린 아키텍처처럼 육각형 아키텍처도 계층으로 구성할 수 있다.
가장 바깥쪽 계층은 애플리케이션과 다른 시스템 간의 번역을 담당하는 어댑터로 구성돼 있다.
다음으로 포트와 유스케이스 구현체를 결합해서 애플리케이션을 구성할 수 있는데, 이 두가지가 애플리케이션의 인터페이스를 정의하기 때문이다. 마지막 계층에는 도메인 엔티티가 위치한다.

# 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

의존성을 역전시켜 도메인 코드가 다른 바깥쪽 코드에 의존하지 않게 함으로써 영속성과 UI에 특화된 모든 문제로부터 도메인 로직의 결합을 제거하고 코드를 변경할 이유의 수를 줄일 수 있다.
그리고 변경할 이유가 적을수록 유지보수성은 더 좋아진다.

또한 도메인 코드는 비즈니스 문제에 맞도록 자유롭게 모델링 될 수 있고, 영속성 코드와 UI코드도 영속성 문제와 UI문제에 맞게 자유롭게 모델링 될 수 있다.

# 아키텍처적으로 표현력 있는 패키지 구조

육각형 아키텍처에서 구조적 으로 핵심적인 요소는 `엔티티`, `유스케이스`, `인커밍/아웃고잉 포트`, `인커밍/아웃고잉` 어뎁터이다.

```text
buckpal
|-- account # 최상위에 Account 관련 유스케이스를 구현한 모듈임을 나타냄
    |-- adapter
    |   |-- in
    |   |   |-- web
    |   |       |-- AccountController
    |   |-- out
    |   |   |-- persistence
    |   |       |-- AccountPersistenceAdapter
    |   |       |-- SpringDataAccountRepository
    |-- domain #도메인 모델에 속한 domain 패키지
    |   |-- Account
    |   |-- Activity
    |-- application #도메인 모델을 둘러싼 서비스 계층 포함
        |-- SendMoneyService # SendMoneyUseCase구현
        |-- port
            |-- in
            |   |-- SendMoneyUseCase
            |-- out
            |   |-- LoadAccountPort
            |   |-- UpdateAccountStatePort
```

- [*] 아키텍처와 코드 갭을 줄여야 한다.
	> 만약, 패키지 구조가 아키텍처를 반영할 수 없다면, 시간이 지남에 따라 코드는 점점 목표하던 아키텍처로 부터 멀어지기 시작하는 것이다.

이 패키지의 또 다른 매력적인 장점은 DDD개념에 직접적으로 대응시킬 수 있다는 점이다.
`account`같은 상위 레벨 패키지는 다른 바운디드 컨텍스트와 통신할 전용 진입점과 출구(포트)를 포함하는 바운디드 컨텍스트에 해당한다.
- domain 패키지 내에서는 DDD가 제공하는 모든 도구를 이용해 우리가 원하는 어떤 도메인이든 만들 수 있다.

> [!info] 완벽한 방법은 없다.
> 그러나 표현력 있는 패키지 구조는 적어도 코드와  아키텍처 간의 갭을 줄일 수 있게 해준다.

## 의존성 주입의 역할

클린 아키텍처의 가장 본질적인 요건은 <u>애플리케이션 계층이 인커밍/아웃고잉 어댑터에 의존성을 갖지 않는 것이다.</u> 이를 지키기 위해 의존성 역전 원칙을 사용한다.

![웹 컨트롤러가 서비스에 의해 구현된 인커밍 포트를 호출한다. 서비스는 어뎁터에 의해 구현된 아웃고잉 포트를 호출한다.](https://velog.velcdn.com/images/yhlee9753/post/df667894-2949-4262-96de-206d8bdb16de/image.png)

